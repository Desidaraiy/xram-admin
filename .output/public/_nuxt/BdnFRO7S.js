import{_ as j,a as G}from"./DTQ49aZk.js";import{_ as I}from"./sfjfEMc_.js";import{a as M,_ as q}from"./DJfxPBq4.js";import{_ as F}from"./DYukAyPS.js";import{g as O,f as P,j as d,i as E,r as H,G as p,c as x,b as s,w as n,_ as L,o as v,k as h,D as R,a as o,n as z,v as A,C as J,B as y,ad as S,t as b,q as K}from"./DSqohS_p.js";import{_ as Q}from"./C2qxqNzf.js";import{_ as W}from"./B8F8NKH2.js";import"./C3z8ikX4.js";const X={class:"grid grid-cols-3 gap-6"},Y={class:"col-span-2"},Z={class:"flex items-center my-8"},ee=o("span",null,"Отправить сейчас",-1),te={class:"flex flex-row justify-center items-center w-full"},le={class:"w-80 h-160 border-4 border-slate-800 dark:border-slate-500 rounded-3xl flex flex-col items-center justify-center px-2"},se={class:"flex flex-col mx-4 rounded-lg dark:bg-slate-400 bg-slate-300 drop-shadow-md w-full"},oe={class:"flex flex-row justify-between w-full rounded-t-lg px-2 py-1/2 dark:bg-slate-500"},ae={class:"flex flex-row"},ne=o("span",{class:"font-light text-lg ml-2"},"Телеос-1",-1),re=o("span",{class:"font-light text-display"},"сейчас",-1),ie={class:"w-full flex flex-col px-2 py-2"},ue={key:0,class:"font-bold text-display mb-1"},de={key:1,class:"font-medium text-display my-1"},ce={class:"font-light text-display mt-1 text-ellipsis line-clamp-2"},be={__name:"index",setup(me){const w=O(),$=P(),k=d([]);E(()=>{w.query.groupid&&k.value.push(w.query.groupid)});function V(t){return t===!0?1:0}function B(t){return t=t.concat(":00"),t.replace("T"," ")}const c=d(""),r=d("Телеос-1"),T=new Date().toISOString(),e=H({title:r.value,message:c.value,groups_id:[],to_all:0,users_id:[],token:$.userToken,date:T,now:1,date:""}),i=d(!0),_=d(""),u=d([]);p(u,()=>{e.to_all=V(u.value.length===0),e.groups_id=u.value}),p(i,()=>{e.now=V(i.value),i.value&&(e.date="")}),p(_,()=>{e.date=B(_.value)}),p(r,t=>{e.title=t}),p(c,t=>{e.message=t});const C=async()=>{if(e.message.length==0){alert("Введите текст");return}if(e.title.length==0){alert("Введите заголовок");return}if(e.now==0&&e.date==""){alert("Выберите дату рассылки или нажмите «Отправить сейчас»");return}u.value.length==0&&(e.to_all=1,e.groups_id=[]);const t=K+"create-message";await $fetch(t,{method:"POST",body:e}).then(l=>{const m=l.message;m==="ok"?(alert("Уведомление отправлено!"),e.message="",e.title="",e.subtitle="",e.groups_id=[],e.users_id=[],e.to_all=0,e.date="",e.now=1):alert(m)})};return(t,l)=>{const m=G,U=I,f=M,g=q,D=F,N=L;return v(),x("div",null,[s(N,{name:"authenticated"},{default:n(()=>[s(Q,null,{default:n(()=>[s(W,{icon:h(R),title:"Рассылка PUSH-уведомлений",main:""},{default:n(()=>[s(m,{color:"success",label:"План рассылок",to:"/pushmailing/planned"})]),_:1},8,["icon"]),o("div",X,[o("div",Y,[s(j,{form:""},{default:n(()=>[s(f,{label:"Группы",help:"Выберите группы для рассылки"},{default:n(()=>[s(U,{modelValue:u.value,"onUpdate:modelValue":l[0]||(l[0]=a=>u.value=a),"pre-selected-groups":k.value},null,8,["modelValue","pre-selected-groups"])]),_:1}),s(f,{label:"Заголовок",help:"Заголовок уведомления"},{default:n(()=>[s(g,{name:"title",modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=a=>r.value=a)},null,8,["modelValue"])]),_:1}),s(f,{label:"Сообщение",help:"Введите сообщение"},{default:n(()=>[s(g,{type:"textarea",name:"message",modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=a=>c.value=a)},null,8,["modelValue"])]),_:1}),o("div",Z,[z(o("input",{type:"checkbox",class:"form-checkbox rounded-full text-primary-500 border-primary-500 focus:ring-primary-500 mr-4 p-3","onUpdate:modelValue":l[3]||(l[3]=a=>i.value=a)},null,512),[[A,i.value]]),ee]),i.value?y("",!0):(v(),J(f,{key:0,label:"Дата и время",help:"В эту дату и время начнется рассылка"},{default:n(()=>[s(g,{type:"datetime-local",name:"date",modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=a=>_.value=a)},null,8,["modelValue"])]),_:1})),o("div",te,[s(m,{color:"info",label:"Отправить",onClick:l[5]||(l[5]=a=>C()),icon:h(S)},null,8,["icon"])])]),_:1})]),o("div",le,[o("div",se,[o("div",oe,[o("div",ae,[s(D,{path:h(S)},null,8,["path"]),ne]),re]),o("div",ie,[r.value!==""?(v(),x("span",ue,b(r.value),1)):y("",!0),t.displaySubtitle!==""?(v(),x("span",de,b(t.displaySubtitle),1)):y("",!0),o("span",ce,b(c.value),1)])])])])]),_:1})]),_:1})])}}};export{be as default};
