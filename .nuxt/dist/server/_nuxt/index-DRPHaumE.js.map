{"version":3,"file":"index-DRPHaumE.js","sources":["../../../../components/TableSampleAdmins.vue","../../../../pages/admins/index.vue"],"sourcesContent":["<script setup>\nimport { computed, ref } from 'vue'\nimport { useMainStore } from '@/stores/main'\nimport { useStyleStore } from '@/stores/style'\nimport { mdiEye, mdiTrashCan } from '@mdi/js'\nimport CardBoxModal from '@/components/CardBoxModal.vue'\nimport TableCheckboxCell from '@/components/TableCheckboxCell.vue'\nimport BaseLevel from '@/components/BaseLevel.vue'\nimport BaseButtons from '@/components/BaseButtons.vue'\nimport BaseButton from '@/components/BaseButton.vue'\nimport { proxyBaseUrl, tokenCookieName } from \"~~/configs/fetchBaseUrl\";\n\ndefineProps({\n  checkable: Boolean\n})\n\nconst etoken = useCookie(tokenCookieName, { sameSite: \"None\", secure: true });\n\nconst styleStore = useStyleStore()\n\nconst mainStore = useMainStore()\n\nconst items = computed(() => mainStore.isSearchingAdmins\n  ? mainStore.adminsFound\n  : mainStore.admins)\n\nconst currentAdminId = ref(0);\n\nconst isModalActive = ref(false)\n\nconst isModalDangerActive = ref(false)\n\nconst isModalMessagesActive = ref(false)\n\nconst perPage = ref(10)\n\nconst currentPage = ref(0)\n\nconst checkedRows = ref([])\n\nconst itemsPaginated = computed(\n  () => items.value.slice(perPage.value * currentPage.value, perPage.value * (currentPage.value + 1))\n)\n\nconst numPages = computed(() => Math.ceil(items.value.length / perPage.value))\n\nconst currentPageHuman = computed(() => currentPage.value + 1)\n\nconst pagesList = computed(() => {\n  const pagesList = []\n  for (let i = 0; i < numPages.value; i++) {\n    pagesList.push(i)\n  }\n  return pagesList\n})\n\nconst remove = (arr, cb) => {\n  const newArr = []\n\n  arr.forEach(item => {\n    if (!cb(item)) {\n      newArr.push(item)\n    }\n  })\n\n  return newArr\n}\n\nconst checked = (isChecked, client) => {\n  if (isChecked) {\n    checkedRows.value.push(client)\n  } else {\n    checkedRows.value = remove(checkedRows.value, row => row.id === client.id)\n  }\n}\n\n\nconst deleteAdmin = async () => {\n  const path = proxyBaseUrl + \"remove-admin\";\n  await $fetch(path, {\n    method: \"POST\",\n    body: {\n      id: currentAdminId.value,\n      token: etoken.value,\n    },\n  }).then((r) => {\n    if (r.message === \"ok\") {\n      isModalMessagesActive.value = false\n      mainStore.getAdminsList()\n    }\n  });\n};\n</script>\n\n<template>\n\n  <CardBoxModal\n    v-model=\"isModalMessagesActive\"\n    title=\"Удаление администратора\"\n  >\n    <p>Данное действие необратимо.</p>\n    \n    <BaseButtons>\n      <BaseButton\n        color=\"danger\"\n        @click=\"deleteAdmin()\"\n        label=\"Удалить\"/>\n      <BaseButton\n        color=\"info\"\n        outline\n        @click=\"currentAdminId = 0; isModalMessagesActive = false\"\n        label=\"Отмена\"/>\n        \n    </BaseButtons>\n  </CardBoxModal>\n\n  <div\n    v-if=\"checkedRows.length\"\n    class=\"p-3 bg-gray-100/50 dark:bg-slate-800\"\n  >\n    <span\n      v-for=\"checkedRow in checkedRows\"\n      :key=\"checkedRow.id\"\n      class=\"inline-block px-2 py-1 rounded-sm mr-2 text-sm bg-gray-100 dark:bg-slate-700\">\n      {{ checkedRow.name }}\n    </span>\n  </div>\n\n  <table>\n    <thead>\n      <tr>\n        <th v-if=\"checkable\" />\n        <th>Имя, Фамилия</th>\n        <th>Телефон</th>\n        <!-- <th>E-mail</th> -->\n        <th>Редактировать</th>\n        <th>Удалить</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr\n        v-for=\"client in itemsPaginated\"\n        :key=\"client.id\"\n      >\n        <TableCheckboxCell\n          v-if=\"checkable\"\n          @checked=\"checked($event, client)\"\n        />\n        <td data-label=\"Имя, Фамилия\">\n          {{ client.fio.length > 0 ? client.fio : '---' }}\n        </td>\n        <td data-label=\"Телефон\">\n          {{ client.phone.length > 0 ? client.phone : '---' }}\n        </td>\n        <td data-label=\"Редактировать\">\n          <BaseButton\n            color=\"info\"\n            label=\"Редактировать\"\n            :to=\"`/admins/edit/${client.id}`\"\n          />\n        </td>\n        <td data-label=\"Удалить\">\n          <BaseButton\n            color=\"info\"\n            label=\"Удалить\"\n            @click=\"currentAdminId = client.id; isModalMessagesActive = true\"\n          />        \n        </td>\n      </tr>\n    </tbody>\n  </table>\n  <div\n    class=\"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800\"\n  >\n    <BaseLevel>\n      <BaseButtons>\n        <BaseButton\n          v-for=\"page in pagesList\"\n          :key=\"page\"\n          :active=\"page === currentPage\"\n          :label=\"page + 1\"\n          small\n          :outline=\"styleStore.darkMode\"\n          @click=\"currentPage = page\"\n        />\n      </BaseButtons>\n      <small>Страница {{ currentPageHuman }} из {{ numPages }}</small>\n    </BaseLevel>\n  </div>\n</template>\n","<script setup>\r\nimport { onMounted } from 'vue'\r\nimport { useMainStore } from '@/stores/main'\r\nimport {\r\n  mdiChartTimelineVariant,\r\n  mdiAccountMultiplePlus\r\n} from '@mdi/js'\r\nimport SectionMain from '@/components/SectionMain.vue'\r\nimport CardBox from '@/components/CardBox.vue'\r\nimport BaseButton from '@/components/BaseButton.vue'\r\nimport SectionTitleLineWithButton from '@/components/SectionTitleLineWithButton.vue'\r\n\r\nconst mainStore = useMainStore()\r\nonMounted(() => {\r\n  mainStore.getAdminsList()\r\n})\r\n\r\nconst handleSearchString = (value) => {\r\n  mainStore.setSearchingAdminsQuery(value)\r\n}\r\n\r\n</script>\r\n\r\n<template>\r\n  <div>\r\n    <NuxtLayout name=\"authenticated\">\r\n          <SectionMain>\r\n      <SectionTitleLineWithButton\r\n        :icon=\"mdiChartTimelineVariant\"\r\n        title=\"Администраторы\"\r\n        main\r\n      >\r\n      <BaseButton\r\n            color=\"success\"\r\n            label=\"Добавить\"\r\n            to=\"/admins/new\"\r\n          />   \r\n      </SectionTitleLineWithButton>\r\n      <CardBox\r\n        :icon=\"mdiAccountMultiplePlus\"\r\n        title=\"&nbsp;\"\r\n        has-table\r\n        has-searchbar\r\n        @search-string=\"handleSearchString\">\r\n        <TableSampleAdmins\r\n        :checkable=\"false\"\r\n          />\r\n      </CardBox>\r\n\r\n    </SectionMain>\r\n    </NuxtLayout>\r\n  </div>\r\n\r\n</template>\r\n"],"names":["pagesList"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,UAAM,SAAS,UAAU,iBAAiB,EAAE,UAAU,QAAQ,QAAQ,KAAI,CAAE;AAE5E,UAAM,aAAa,cAAe;AAElC,UAAM,YAAY,aAAc;AAEhC,UAAM,QAAQ,SAAS,MAAM,UAAU,oBACnC,UAAU,cACV,UAAU,MAAM;AAEpB,UAAM,iBAAiB,IAAI,CAAC;AAEN,QAAI,KAAK;AAEH,QAAI,KAAK;AAErC,UAAM,wBAAwB,IAAI,KAAK;AAEvC,UAAM,UAAU,IAAI,EAAE;AAEtB,UAAM,cAAc,IAAI,CAAC;AAEzB,UAAM,cAAc,IAAI,EAAE;AAE1B,UAAM,iBAAiB;AAAA,MACrB,MAAM,MAAM,MAAM,MAAM,QAAQ,QAAQ,YAAY,OAAO,QAAQ,SAAS,YAAY,QAAQ,EAAE;AAAA,IACpG;AAEA,UAAM,WAAW,SAAS,MAAM,KAAK,KAAK,MAAM,MAAM,SAAS,QAAQ,KAAK,CAAC;AAE7E,UAAM,mBAAmB,SAAS,MAAM,YAAY,QAAQ,CAAC;AAE7D,UAAM,YAAY,SAAS,MAAM;AAC/B,YAAMA,aAAY,CAAE;AACpB,eAAS,IAAI,GAAG,IAAI,SAAS,OAAO,KAAK;AACvC,QAAAA,WAAU,KAAK,CAAC;AAAA,MACjB;AACD,aAAOA;AAAA,IACT,CAAC;AAED,UAAM,SAAS,CAAC,KAAK,OAAO;AAC1B,YAAM,SAAS,CAAE;AAEjB,UAAI,QAAQ,UAAQ;AAClB,YAAI,CAAC,GAAG,IAAI,GAAG;AACb,iBAAO,KAAK,IAAI;AAAA,QACjB;AAAA,MACL,CAAG;AAED,aAAO;AAAA,IACT;AAEA,UAAM,UAAU,CAAC,WAAW,WAAW;AACrC,UAAI,WAAW;AACb,oBAAY,MAAM,KAAK,MAAM;AAAA,MACjC,OAAS;AACL,oBAAY,QAAQ,OAAO,YAAY,OAAO,SAAO,IAAI,OAAO,OAAO,EAAE;AAAA,MAC1E;AAAA,IACH;AAGA,UAAM,cAAc,YAAY;AAC9B,YAAM,OAAO,eAAe;AAC5B,YAAM,OAAO,MAAM;AAAA,QACjB,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ,IAAI,eAAe;AAAA,UACnB,OAAO,OAAO;AAAA,QACf;AAAA,MACL,CAAG,EAAE,KAAK,CAAC,MAAM;AACb,YAAI,EAAE,YAAY,MAAM;AACtB,gCAAsB,QAAQ;AAC9B,oBAAU,cAAe;AAAA,QAC1B;AAAA,MACL,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/EA,UAAM,YAAY,aAAc;AAKhC,UAAM,qBAAqB,CAAC,UAAU;AACpC,gBAAU,wBAAwB,KAAK;AAAA,IACzC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}