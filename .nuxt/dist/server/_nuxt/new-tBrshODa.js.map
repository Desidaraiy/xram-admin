{"version":3,"file":"new-tBrshODa.js","sources":["../../../../components/FormFilePicker.vue","../../../../pages/advertising/new.vue"],"sourcesContent":["<script setup>\nimport { mdiUpload } from '@mdi/js'\nimport { computed, ref, watch } from 'vue'\nimport BaseButton from '@/components/BaseButton.vue'\n\nconst props = defineProps({\n  modelValue: {\n    type: [Object, File, Array],\n    default: null\n  },\n  label: {\n    type: String,\n    default: 'Upload'\n  },\n  icon: {\n    type: String,\n    default: mdiUpload\n  },\n  accept: {\n    type: String,\n    default: null\n  },\n  color: {\n    type: String,\n    default: 'info'\n  }\n})\n\nconst emit = defineEmits(['update:modelValue'])\n\nconst root = ref(null)\n\nconst file = ref(props.modelValue)\n\nconst modelValueProp = computed(() => props.modelValue)\n\nwatch(modelValueProp, value => {\n  file.value = value\n  if (!value) {\n    root.value.input.value = null\n  }\n})\n\nconst upload = event => {\n  const value = event.target.files || event.dataTransfer.files\n  file.value = value[0]\n  emit('update:modelValue', file.value)\n}\n</script>\n\n<template>\n  <div class=\"flex items-stretch justify-start relative\">\n    <label class=\"inline-flex\">\n      <BaseButton\n        as=\"a\"\n        :label=\"label\"\n        :icon=\"icon\"\n        :color=\"color\"\n        :class=\"{ 'rounded-r-none': file }\"\n      />\n      <input\n        ref=\"root\"\n        type=\"file\"\n        class=\"absolute top-0 left-0 w-full h-full opacity-0 outline-none cursor-pointer -z-1\"\n        :accept=\"accept\"\n        @input=\"upload\"\n      >\n    </label>\n    <div v-if=\"file\">\n      <span\n        class=\"inline-flex px-4 py-2 justify-center bg-gray-100 dark:bg-slate-800 border-gray-200 dark:border-slate-700 border rounded-r\"\n      >\n        {{ file.name }}\n      </span>\n    </div>\n  </div>\n</template>\n","<script setup>\nimport { ref, reactive, onMounted } from \"vue\";\nimport { mdiChevronLeft } from \"@mdi/js\";\nimport SectionMain from \"@/components/SectionMain.vue\";\nimport CardBox from \"@/components/CardBox.vue\";\nimport { proxyBaseUrl } from \"~~/configs/fetchBaseUrl\";\nimport { useMainStore } from \"~~/stores/main\";\n\nconst route = useRoute()\n\nconst router = useRouter()\n\nconst preSelectedGroups = ref([])\n\nonMounted(() => {\n  if(route.query.groupid){\n    preSelectedGroups.value.push(route.query.groupid)\n  }\n})\n\nconst mainStore = useMainStore();\n\nconst pictureToUpload = ref(null);\nconst previewToUpload = ref(null);\n\nconst selectedGroups = ref([]);\n\nconst form = reactive({\n  action_url: \"\",\n  token: mainStore.userToken,\n  text: \"\",\n  title: \"\",\n  to_all: true,\n  groups_id: [],\n  date_start: \"\",\n  date_end: \"\",\n  redirect: false,\n});\n\nconst addAdvert = async () => {\n  let formdata = new FormData();\n\n\n  if(previewToUpload.value === null){\n    alert(\"Не выбран графический файл\");\n    return\n  }else{\n    formdata.append(\"preview\", previewToUpload.value);\n  }\n\n  if(form.redirect === false && pictureToUpload.value === null){\n    alert(\"Не выбран графический файл\");\n    return\n  }else{\n    formdata.append(\"picture\", pictureToUpload.value);\n  }\n  \n  // formdata.append(\"preview\", previewToUpload.value);\n  // formdata.append(\"picture\", pictureToUpload.value);\n\n  if(form.action_url == ''){\n    alert(\"Не введена ссылка\");\n    return\n  }\n  if(form.text == ''){\n    alert(\"Не введен текст\");\n    return\n  }\n  if(form.title == ''){\n    alert(\"Не введено название\");\n    return\n  }\n  if(form.date_start == '' || form.date_end == ''){\n    alert(\"Не введены даты\");\n    return\n  }\n  formdata.append(\"action_url\", form.action_url);\n  formdata.append(\"text\", form.text);\n  formdata.append(\"date_start\", form.date_start);\n  formdata.append(\"date_end\", form.date_end);\n  formdata.append(\"redirect\", boolToInt(form.redirect));\n  formdata.append(\"token\", form.token);\n  formdata.append(\"title\", form.title);\n  const path = proxyBaseUrl + \"add-advertising\";\n  await $fetch(path, {\n    method: \"POST\",\n    body: formdata,\n  }).then(async (r) => {\n    if (r.message === \"ok\") {\n      await setVisibility(r.advertise.id);\n      router.back();\n      mainStore.getAdvertsList();\n    } else {\n      alert(\"Ошибка: Графический файл \"  + r.picture);\n    }\n  });\n  formdata = new FormData();\n};\n\nconst setVisibility = async (id) => {\n  console.log('set visibility', id);\n  let path;\n\n  const body = {\n    token: form.token,\n    advertising_id: id,\n  };\n\n  if(form.to_all){\n    body.to_all = 1;\n    body.users_id = [];\n    path = proxyBaseUrl + \"advertising-to-users\";\n  } else {\n    body.to_all = 0;\n    body.groups_id = form.groups_id;\n    path = proxyBaseUrl + \"advertising-to-groups\";\n  }\n  \n  await $fetch(path, {\n    method: \"POST\",\n    body: body}).then((r) => {\n      console.log(r)\n    });\n};\n\nwatch(selectedGroups, () => {\n  form.to_all = selectedGroups.value.length === 0\n  form.groups_id = selectedGroups.value\n});\n\nfunction boolToInt(bool) {\n  return bool === true ? 1 : 0;\n}\n</script>\n\n<template>\n  <div>\n    <NuxtLayout name=\"authenticated\">\n      <SectionMain>\n        <SectionTitleLine\n          :icon=\"mdiChevronLeft\"\n          title=\"Добавить объявление\"\n          :back=\"true\"\n          main\n        >\n        </SectionTitleLine>\n\n        <div class=\"grid grid-cols-1 w-full gap-4\">\n          <CardBox title=\"Информация\" form>\n\n            <FormField label=\"Группы\">\n              <GroupsIdSelector v-model=\"selectedGroups\" :pre-selected-groups=\"preSelectedGroups\" />\n            </FormField>\n\n            <FormField label=\"Текст для предварительного просмотра (10-25 символов)\">\n              <FormControl\n                v-model=\"form.title\"\n                placeholder=\"Текст\"\n                type=\"text\"\n              />\n            </FormField>\n\n            <FormField label=\"Текст для кнопки перехода (10-25 символов)\">\n              <FormControl\n                v-model=\"form.text\"\n                placeholder=\"Текст\"\n                type=\"text\"\n              />\n            </FormField>\n            <FormField label=\"Ссылка для перехода\">\n              <FormControl\n                v-model=\"form.action_url\"\n                placeholder=\"https://...\"\n                type=\"text\"\n              />\n            </FormField>\n            <FormField label=\"Дата, с которой будет видно объявление\">\n              <FormControl\n                v-model=\"form.date_start\"\n                placeholder=\"Дата\"\n                type=\"date\"\n              />\n            </FormField>\n            <FormField label=\"Дата, в которую объявление будет скрыто\">\n              <FormControl\n                v-model=\"form.date_end\"\n                placeholder=\"Дата\"\n                type=\"date\"\n              />\n            </FormField>\n            <FormField label=\"Без полноразмерной картинки \">\n              <input type=\"checkbox\" v-model=\"form.redirect\" />\n            </FormField>\n            <FormField\n              label=\"Картинка для отображения в сторис (1080х1920, вертикаль, JPG, PNG, JPEG)\"\n            >\n              <FormFilePicker\n                v-model=\"pictureToUpload\"\n                label=\"Загрузить картинку\"\n                color=\"success\"\n              />\n            </FormField>\n            <FormField label=\"Миниатюра (500х500 JPG, PNG, JPEG)\">\n              <FormFilePicker\n                v-model=\"previewToUpload\"\n                label=\"Загрузить картинку\"\n                color=\"success\"\n              />\n            </FormField>\n          </CardBox>\n        </div>\n        <div class=\"flex flex-row justify-start items-center m-2\">\n          <BaseButtons>\n            <BaseButton color=\"info\" label=\"Отмена\" to=\"/advertising\" />\n            <BaseButton\n              color=\"success\"\n              label=\"Создать объявление\"\n              @click=\"addAdvert()\"\n            />\n          </BaseButtons>\n        </div>\n      </SectionMain>\n    </NuxtLayout>\n  </div>\n</template>\n"],"names":[],"mappings":"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"}